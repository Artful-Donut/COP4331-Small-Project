<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Contact Manager - Sign In</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel = "stylesheet" href = "styles.css">
</head>

<body>
    <div class="container">
        <div class="login-container">
            <h3 class="text-center mb-3">Sign in</h3>
            <p class="text-center text-muted">Stay updated on your professional world</p>

            <form action="Login.php" method="POST">
                <div class="mb-3">
                    <input type="email" class="form-control" placeholder="Email or Phone" required>
                </div>

                <div class="mb-3 password-container">
                    <input type="password" class="form-control" id="password" placeholder="Password" required>
                    <span class="password-toggle" onclick="togglePassword()">üëÅÔ∏è</span>
                </div>

                <!-- <a href="#" class="text-decoration-none d-block mb-3">Forgot password?</a> -->

                <button type="submit" class="btn btn-primary w-100 py-2" onclick="doLogin();">Sign in</button>

                <!-- <div class="text-center mt-3">or</div> -->

                <!-- <button type="button" class="apple-btn mt-3">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg" width="20"> Sign
                    in with Apple
                </button> -->
            </form>
        </div>

        <div class="footer">
            <p>New to Contact Manager? <a href="register.html">Join now</a></p>
        </div>
    </div>

    <script>
        function togglePassword() {
            var passwordField = document.getElementById("password");
            if (passwordField.type === "password") {
                passwordField.type = "text";
            } else {
                passwordField.type = "password";
            }
        }
    </script>

    <script>
      const urlBase = 'http://contact.afari.online/LAMPAPI';
      const extension = 'php';

      function doLogin()
      {
        userId = 0;
        firstName = "";
        lastName = "";
        
        let login = document.getElementById("loginName").value;
        
        //document.getElementById("loginResult").innerHTML = "";

        let tmp = {login:login,password:password};

        let jsonPayload = JSON.stringify( tmp );
        
        let url = urlBase + '/Login.' + extension;

        let xhr = new XMLHttpRequest();
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-type", "application/json; charset=UTF-8");
        try
        {
          xhr.onreadystatechange = function() 
          {
            if (this.readyState == 4 && this.status == 200) 
            {
              let jsonObject = JSON.parse( xhr.responseText );
              userId = jsonObject.id;
          
              if( userId < 1 )
              {		
                document.getElementById("loginResult").innerHTML = "User/Password combination incorrect";
                return;
              }
          
              firstName = jsonObject.firstName;
              lastName = jsonObject.lastName;

              saveCookie();
        
              window.location.href = "dashboard.html";
            }
          };
          xhr.send(jsonPayload);
        }
        catch(err)
        {
          //document.getElementById("loginResult").innerHTML = err.message;
              window.alert("You failed.");
        }

      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>